;*******************************************************************************
;
;	ИНИЦИАЛИЗАЦИЯ    РЕГИСТРОВ   МИКРОКОНТРОЛЛЕРА  PIC16F628A
;
;*******************************************************************************
    
init:
    errorlevel -302 ;не напоминать что банк не 0
    ;--------------------------------------------------------------------------
    ;	BANK 0
    ;--------------------------------------------------------------------------
    bcf	    STATUS, RP0
    bcf	    STATUS, RP1	    ;переход в банк 0 для доступа к регистрам банка 0
    ;INDF - обращение к регистру , адрес которого записан в FSR
    ;TMR0 - регистр таймера 0
    ;PCL - младшие биты счетчика команд
    clrf    STATUS	    ;очистим STATUS
    ;FSR - регистр адреса при косвенной адресации
    ;настроим начальные уровни на выходах портов вывода
    clrf    PORTA 
    clrf    PORTB
    clrf    PCLATH	    ;Подтвердим нулевое значеие в регистре защелке 
                            ;старших битов адреса команд
    movlw   b'00000000'	    ;запрет прерываний всем
    movwf   INTCON
    ;PIR1
    ;TMR1L - младшие биты TMR1
    ;TMR1H - старшие биты TMR1
    movlw   b'00000001'
    movwf   T1CON
    ;TMR2 - регистр таймера 2
    ;T2CON
    ;CCPR1L - младший байт ШИМ CCP1
    ;CCPR1H - старший байт ШИМ CCP1
    movlw   b'00000000'	    ;выключаем ШИМ CCP1
    movwf   CCP1CON
    clrf    RCSTA	    ;USART OFF
    ;TXREG - регистр данных передатчика USART
    ;RСXREG - регистр данных приемника USART
    movlw   b'00000111'	    ;выключаем компараторы
    movwf   CMCON
    
    ;--------------------------------------------------------------------------
    ;	BANK 1
    ;--------------------------------------------------------------------------
    
    bsf	    STATUS, RP0
    ;INDF - обращение к регистру , адрес которого записан в FSR
    movlw   b'10000111'
    movwf   OPTION_REG ;Предделитель перед TMR0 коэффициент 1:256
    ;PCL - младшие биты счетчика команд
    ;STATUS 
    ;FSR - регистр адреса при косвенной адресации
    movlw   b'11110000'	    ; 5,4,6,7 - входы
    movwf   TRISA
    movlw   b'10011100'	    ; 2,3,4,7 - входы
    movwf   TRISB
    ;PCLATH
    ;INTCON
    clrf   PIE1 & 0x7F	    ;запретили все периферийные прерывания
    ;PCON
    ;PR2 - регистр периода TMR2
    ;TXSTA - Регистр управления и статуса USART
    ;SPBRG - регистр генератора скорости USART
    ;EEDATA - регистр данных, младший байт
    ;EEADDR - регистр адреса, младший байт
    ;EECON1 - регистр управления 1
    ;EECON2 - регистр управления 2
    ;VRCON - регистр источника опорного напряжения
    
    ;--------------------------------------------------------------------------
    ;	BANK 2
    ;--------------------------------------------------------------------------
    ;bcf STATUS, RP0
    ;bsf STATUS, RP1
    ;INDF - обращение к регистру , адрес которого записан в FSR
    ;TMR0 - регистр таймера TMR0
    ;PCL - младшие биты счетчика команд
    ;STATUS
    ;FSR - регистр адреса при косвенной адресации
    ;PORTB - запись в выходную защелку PORTB, чтение состояния выводов PORTB
    ;PCLATH - старшие биты счетчика команд
    ;INTCON
    
    ;--------------------------------------------------------------------------
    ;	BANK 3
    ;--------------------------------------------------------------------------
    ;bsf STATUS, RP0
    ;bsf STATUS, RP1
    ;INDF - обращение к регистру , адрес которого записан в FSR
    ;OPTION_REG
    ;PCL - младшие биты счетчика команд
    ;STATUS
    ;FSR - регистр адреса при косвенной адресации
    ;TRISB - направление выводов PORTB
    ;PCLATH - старшие биты счетчика команд
    ;INTCON
    
    bcf	    STATUS, RP0
    bcf	    STATUS, RP1	    ;возврат в BANK 0 

    ;Здесь, по потребности, присвоим переменным начальные значения
    movlw   0x00
;    movwf GPtmp ; При инициализации обнуляем регистр, выводимый в порт PORTC
    movwf   Flags	    ; При инициализации все флаги обнуляем
;    movwf ZERO
    ;Очистка регистров хранения температуры и времени охлаждения
;    movwf Heat_low
;    movwf Heat_high
    movwf   TMR0_user_max
    ;очистка и запись констант для TMR0
    movwf   TMR0_inc
    movwf   TMR0_user_inc
    movwf   TMR0_user_max
    ;movlw 0x4E		    ;~78 переполнений TMR0 = 1 секунда при Fosc = 20 МГц 
    movlw   .8		    ;~8 переполнений = 0.1с
    movwf   TMR0_max
    movlw   0x04
    movwf   TMR0
    return

#INCLUDE Memory.inc 
; Init End ---------------------------------------------------------------------