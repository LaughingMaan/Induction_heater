MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ; PIC16F628A Configuration Bit Settings
                      00002 ; ASM source line config statements
                      00003 #include "p16F628A.inc"
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : Mar 17 2019
                      00005 ;  MPASM PIC16F628A processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2019 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      00386         LIST
                      00004 
                      00005 
                      00006 #define COOL_LED    PORTA, 0
                      00007 #define CLK_B       PORTA, 1
                      00008 #define ENABLE_LED  PORTA, 2
                      00009 #define DATA_LED    PORTA, 3
                      00010 #define STOP_B      PORTA, 4
                      00011 #define TEMP_IN     PORTA, 7
                      00012 #define PLUS_B      PORTA, 5
                      00013 #define MINUS_B     PORTA, 6
                      00014 
                      00015 #define ERROR_LED   PORTB, 0
                      00016 #define HEAT_LED    PORTB, 1
                      00017 #define SETUP_B     PORTB, 2
                      00018 #define HEAT_B      PORTB, 3
                      00019 #define WATER       PORTB, 4
                      00020 #define DATA_LED_2  PORTB, 5
                      00021 #define CLK_B_2     PORTB, 6
                      00022 #define SAVE_B      PORTB, 7
                      00023 
                      00024 
                      00025 ; CONFIG
2007   3F18           00026     __CONFIG _FOSC_INTOSCIO & _WDTE_OFF & _PWRTE_OFF & _MCLRE_OFF & _BOREN_OFF & _LVP_OFF & _CPD_OFF & _
                            CP_OFF
                      00027     
                      00028     org     0x00
0000   2???           00029     goto    start ;escape interrupt subprogram
                      00030     org     0x04
0004   2???           00031     goto    Interrupt
                      00032 
0005                  00033 start:
0005   2???           00034     call    init
                      00035 ;--------------------------------------------------------------------------
                      00036 ;временно зададим константы
                      00037 ;--------------------------------------------------------------------------
0006   1283           00038     bcf     STATUS, RP0
0007   1303           00039     bcf     STATUS, RP1
                      00040 
0008   2???           00041     call    EEPROM_READ
0009   2???           00042     call    Bin2Dec
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000A   018E           00043     clrf    TMR1L
000B   018F           00044     clrf    TMR1H
000C   100C           00045     bcf     PIR1, TMR1IF
000D   1683           00046     bsf     STATUS, RP0
                      00047     errorlevel -302
000E   140C           00048     bsf     PIE1, TMR1IE
                      00049     errorlevel +302
000F   1283           00050     bcf     STATUS, RP0
0010   170B           00051     bsf     INTCON, PEIE
0011   178B           00052     bsf     INTCON, GIE
                      00053 
0012   2???           00054     goto    postinit
                      00055 ;*******************************************************************************
                      00056 ;
                      00057 ;       ОСНОВНОЙ ЦИКЛ
                      00058 ;
                      00059 ;*******************************************************************************
0013                  00060 postinit_0:
0013   2???           00061    call     EEPROM_WRITE        ; Запись в ПЗУ после выхода из настройки
0014                  00062 postinit:
0014   0186           00063     clrf    PORTB
0015   1005           00064     bcf     COOL_LED
0016   1986           00065     btfsc   HEAT_B              ; Опрос кнопок
0017   2???           00066     goto    heat                ;
0018   1906           00067     btfsc   SETUP_B             ;
0019   2???           00068     goto    setup               ;
                      00069 
001A   2???           00070     goto    postinit            
                      00071 
001B                  00072 heat:
001B   13A1           00073     bcf     Flags,  7
001C   1486           00074     bsf     HEAT_LED            ; Начинаем нагрев, запустим TMR0
001D   01C3           00075     clrf    TMR0_user_inc       ;
001E   01C1           00076     clrf    TMR0_inc            ;
001F   3004           00077     movlw   0x04                ;
0020   0081           00078     movwf   TMR0                ; 
0021   168B           00079     bsf     INTCON, T0IE        ;
                      00080 
                      00081 
0022                  00082 checks:                         ; Блок проверок во время нагрева
                      00083     
0022   0843           00084     movf    TMR0_user_inc, W    ; Преобразование текущего времени
0023   00A9           00085     movwf   work_data           ;
0024   2???           00086     call    Bin2Dec             ;
                      00087     
0025   1A06           00088     btfsc   WATER               ; Опрос датчика наличия воды
0026   2???           00089     goto    accident            ;
0027   1A05           00090     btfsc   STOP_B              ; Опрос кнопки СТОП
0028   2???           00091     goto    accident            ;
0029   1F85           00092     btfss   TEMP_IN             ; Опрос компаратора
002A   2???           00093     goto    accident            ;
                      00094 
002B   1821           00095     btfsc   Flags, 0            ; Отработано заданое время
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

002C   2???           00096     goto    Work_done           ;
                      00097 
002D   2???           00098     goto    checks              ; Зациклим проверки
                      00099 
002E                  00100 setup:                          ; Блок настроек
                      00101     
002E   1FA1           00102     btfss   Flags,  7
002F   0844           00103     movf    TMR0_user_max, W    ; Запуск преобразования настроек для вывода на
0030   1BA1           00104     btfsc   Flags,  7           ; 7-сегментник
0031   0845           00105     movf    TMR0_user_max_cool, W;
0032   00A9           00106     movwf   work_data           ;
0033   2???           00107     call    Bin2Dec             ;
                      00108     
0034   1D06           00109     btfss   SETUP_B             
0035   2???           00110     goto    postinit_0
0036   1A85           00111     btfsc   PLUS_B
0037   2???           00112     goto    increment
0038   1B05           00113     btfsc   MINUS_B
0039   2???           00114     goto    decrement
003A   1B86           00115     btfsc   SAVE_B
003B   2???           00116     goto    change_mode
003C   2???           00117     goto    setup
003D                  00118 change_mode:
003D   2???           00119     call    Delay_150
003E   1B86           00120     btfsc   SAVE_B
003F   2???           00121     goto    setup
                      00122     
0040   17A1           00123     bsf     Flags, 7
0041   1406           00124     bsf     ERROR_LED
0042   2???           00125     call    Delay
0043   1006           00126     bcf     ERROR_LED
0044   2???           00127     goto    setup
0045                  00128 increment:                      ; При нажатии ПЛЮС попадаем сюда
                      00129     
0045   2???           00130     call    Delay_150           ; Сглаживание дребезга
0046   1E85           00131     btfss   PLUS_B              ;
0047   2???           00132     goto    setup               ;
0048   1BA1           00133     btfsc   Flags, 7
0049   2???           00134     goto    increment_cool
004A                  00135 increment_heat:
004A   30C8           00136     movlw   .200                ; Проверка на превышение макс. значения
004B   0644           00137     xorwf   TMR0_user_max, W    ;
004C   1903           00138     btfsc   STATUS, Z           ;
004D   01C4           00139     clrf    TMR0_user_max       ;
                      00140     
004E   0AC4           00141     incf    TMR0_user_max ,1
004F   2???           00142     goto    setup
0050                  00143 increment_cool:
0050   30C8           00144     movlw   .200                ; Проверка на превышение макс. значения
0051   0645           00145     xorwf   TMR0_user_max_cool, W       
0052   1903           00146     btfsc   STATUS, Z           ;
0053   01C5           00147     clrf    TMR0_user_max_cool  ;
                      00148     
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0054   0AC5           00149     incf    TMR0_user_max_cool ,1
0055   2???           00150     goto    setup
                      00151     
0056                  00152 decrement:                      ; При нажатии минус попадаем сюда
                      00153 
0056   2???           00154     call    Delay_150           ; Сглаживание дребезга
0057   1F05           00155     btfss   MINUS_B             ;
0058   2???           00156     goto    setup               ;
                      00157     
0059   1BA1           00158     btfsc   Flags, 7
005A   2???           00159     goto    decrement_cool
005B   0BC4           00160     decfsz  TMR0_user_max,1     ; Проверка на превышение мин. значения
005C   2???           00161     goto    setup               ;
                      00162     
005D   30C8           00163     movlw   .200                ; Попадаем сюда при TMR0_user_max < 0
005E   00C4           00164     movwf   TMR0_user_max       ;
                      00165     
005F   2???           00166     goto    setup
0060                  00167 decrement_cool:
                      00168     
0060   0BC5           00169     decfsz  TMR0_user_max_cool,1        ; Проверка на превышение мин. значения
0061   2???           00170     goto    setup               ;
                      00171     
0062   30C8           00172     movlw   .200                ; Попадаем сюда при TMR0_user_max < 0
0063   00C5           00173     movwf   TMR0_user_max_cool  ;
                      00174     
0064   2???           00175     goto    setup
0065                  00176 accident:                       ; Попадаем сюда при аварии
                      00177     
0065   0186           00178     clrf    PORTB               ; Остановим нагрев и прерывания по TMR0
0066   128B           00179     bcf     INTCON, T0IE        ; Зажжем светодиод АВАРИЯ и ожиданием
0067   1021           00180     bcf     Flags, 0            ; подтверждения от оператора через кнопку НАГРЕВ
0068   1406           00181     bsf     ERROR_LED           ;
0069   1D86           00182     btfss   HEAT_B              ;
006A   2???           00183     goto    $-1                 ;
006B   0000           00184     nop                         ;
006C   2???           00185     call    Delay               ; Задержка на 1с для исключения дребезга
                      00186     
006D   2???           00187     goto    postinit
                      00188 
006E                  00189 Work_done:                      ; Попадаем сюда если нагрев закончен
                      00190     
006E   1086           00191     bcf     HEAT_LED            ; Выключим нагрев и прерывания от TMR0
006F   128B           00192     bcf     INTCON, T0IE        ;
0070   1021           00193     bcf     Flags, 0            ;
                      00194     
0071   1405           00195     bsf     COOL_LED            ; Начинаем охлаждение, запустим TMR0
0072   01C3           00196     clrf    TMR0_user_inc       ;
0073   01C1           00197     clrf    TMR0_inc            ;
0074   3004           00198     movlw   0x04                ;
0075   0081           00199     movwf   TMR0                ; 
0076   168B           00200     bsf     INTCON, T0IE        ;
0077   0844           00201     movf    TMR0_user_max, W    
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0078   00B8           00202     movwf   TEMP_C
0079   0845           00203     movf    TMR0_user_max_cool, W
007A   00C4           00204     movwf   TMR0_user_max
007B                  00205 Cool:
                      00206    
007B   0843           00207     movf    TMR0_user_inc, W    ; Преобразование текущего времени
007C   00A9           00208     movwf   work_data           ;
007D   2???           00209     call    Bin2Dec             ;
                      00210     
007E   1821           00211     btfsc   Flags, 0            ; Отработано заданое время
007F   2???           00212     goto    Cool_done           ;
0080   2???           00213     goto    Cool                ;
                      00214 
0081                  00215 Cool_done:
0081   1005           00216     bcf     COOL_LED            ; Выключим охлаждение и прерывания от TMR0
0082   128B           00217     bcf     INTCON, T0IE        ;
0083   1021           00218     bcf     Flags,  0           ;
0084   01C3           00219     clrf    TMR0_user_inc
0085   01C1           00220     clrf    TMR0_inc
0086   0838           00221     movf    TEMP_C,   W
0087   00C4           00222     movwf   TMR0_user_max
0088   00A9           00223     movwf   work_data           ;
0089   2???           00224     call    Bin2Dec             ;
008A   2???           00225     goto    postinit
                      00226     
                      00227 ;*******************************************************************************
                      00228 ;
                      00229 ;       ФУНКЦИИ
                      00230 ;
                      00231 ;*******************************************************************************
                      00232 
                      00233 ;*******************************************************************************
                      00234 ;       EEPROM_READ
                      00235 ;-------------------------------------------------------------------------------
                      00236 ; Функция считывает из EEPROM значение для TMR0_user_max
                      00237 ;
                      00238 ;
                      00239 ; На выходе:
                      00240 ;       TMR0_user_max
                      00241 ;-------------------------------------------------------------------------------
008B                  00242 EEPROM_READ:
                      00243     errorlevel -302
008B   1683           00244     bsf     STATUS, RP0
008C   3000           00245     movlw   0x00                        
008D   009B           00246     movwf   EEADR
008E   141C           00247     bsf     EECON1, RD              
008F   081A           00248     movf    EEDATA, W               
0090   1283           00249     bcf     STATUS, RP0
0091   1303           00250     bcf     STATUS, RP1
0092   00C4           00251     movwf   TMR0_user_max
                      00252     
0093   1683           00253     bsf     STATUS, RP0
0094   3001           00254     movlw   0x01                        
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0095   009B           00255     movwf   EEADR
0096   141C           00256     bsf     EECON1, RD              
0097   081A           00257     movf    EEDATA, W               
0098   1283           00258     bcf     STATUS, RP0
0099   1303           00259     bcf     STATUS, RP1
009A   00C5           00260     movwf   TMR0_user_max_cool
                      00261     
009B   15A1           00262     bsf     Flags, 3                ; установка флага - данные ОК
009C   1621           00263     bsf     Flags, 4                ; установка флага - EEPROM Ful
                      00264     
009D   0008           00265     return
                      00266 ;*******************************************************************************
                      00267 ;       EEPROM_WRITE
                      00268 ;-------------------------------------------------------------------------------
                      00269 ; Функция записывает данные TMR0_user_max в EEPROM
                      00270 ;
                      00271 ;
                      00272 ; На входе:
                      00273 ;       TMR0_user_max
                      00274 ;-------------------------------------------------------------------------------
009E                  00275 EEPROM_WRITE:
009E   1683           00276     bsf     STATUS, RP0
009F                  00277 END_WR:
009F   189C           00278     btfsc   EECON1, WR              ; проверить завершение операции записи
00A0   2???           00279     goto    END_WR                  ;
                      00280     
00A1   151C           00281     bsf     EECON1, WREN
00A2   3000           00282     movlw   0x00                
00A3   009B           00283     movwf   EEADR
                      00284     
00A4   1283           00285     bcf     STATUS, RP0
00A5   0844           00286     movf    TMR0_user_max, W
                      00287     
00A6   1683           00288     bsf     STATUS, RP0
00A7   009A           00289     movwf   EEDATA
00A8   3055           00290     movlw   0x55
00A9   009D           00291     movwf   EECON2
00AA   30AA           00292     movlw   0xAA
00AB   009D           00293     movwf   EECON2
00AC   149C           00294     bsf     EECON1, WR
                      00295     
00AD                  00296 END_WRC:
00AD   189C           00297     btfsc   EECON1, WR              ; проверить завершение операции записи
00AE   2???           00298     goto    END_WRC
                      00299     
                      00300     
00AF   151C           00301     bsf     EECON1, WREN
00B0   3001           00302     movlw   0x01                
00B1   009B           00303     movwf   EEADR
                      00304     
00B2   1283           00305     bcf     STATUS, RP0
00B3   0845           00306     movf    TMR0_user_max_cool, W
                      00307     
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00B4   1683           00308     bsf     STATUS, RP0
00B5   009A           00309     movwf   EEDATA
00B6   3055           00310     movlw   0x55
00B7   009D           00311     movwf   EECON2
00B8   30AA           00312     movlw   0xAA
00B9   009D           00313     movwf   EECON2
00BA   149C           00314     bsf     EECON1, WR
00BB   1283           00315     bcf     STATUS, RP0
00BC   0008           00316     return
                      00317 ;*******************************************************************************
                      00318 ;       Bin2Dec
                      00319 ;-------------------------------------------------------------------------------
                      00320 ; Функция переводит переменную work_data в массив комбинаций для вывода на
                      00321 ; 7-сегментный индиктор
                      00322 ;
                      00323 ; На выходе:
                      00324 ;       output_text
                      00325 ;-------------------------------------------------------------------------------
00BD                  00326 Bin2Dec:
00BD   3064           00327     movlw   .100
00BE   2???           00328     call    DivWreg                 ; wreg = сотни, work_data = work_data % 100
00BF   2???           00329     call    GetSegments             ; Получаем соответсвующую комбинацию сегментов
00C0   00A7           00330     movwf   output_text + 2
00C1   300A           00331     movlw   .10
00C2   2???           00332     call    DivWreg                 ; wreg = десятки, work_data = work_data % 10
00C3   2???           00333     call    GetSegments             ; Получаем соответсвующую комбинацию сегментов
00C4   3E80           00334     addlw   SEG_H                   ; У второго разряда зажигаем точку
00C5   00A6           00335     movwf   output_text + 1
00C6   0829           00336     movf    work_data, w            ; wreg = единицы
00C7   2???           00337     call    GetSegments             ; Получаем соответсвующую комбинацию сегментов
00C8   00A5           00338     movwf   output_text + 0
00C9   0008           00339     return   ; Bin2Dec
                      00340 
                      00341 ;*******************************************************************************
                      00342 ;       DivWreg
                      00343 ;-------------------------------------------------------------------------------
                      00344 ; Деление двухбайтового числа на wreg методом вычитания
                      00345 ; Использует переменные:
                      00346 ;       div_result
                      00347 ; На входе:
                      00348 ;       work_data - делимое
                      00349 ;       wreg      - делитель
                      00350 ; На выходе:
                      00351 ;       wreg      - частное
                      00352 ;       work_data - остаток
                      00353 ;-------------------------------------------------------------------------------
00CA                  00354 DivWreg:
00CA   01B0           00355     clrf    div_result
00CB                  00356 DW_Loop:
00CB   0AB0           00357     incf    div_result, f           ; Увеличиваем счетчик вычитаний
00CC   02A9           00358     subwf   work_data, f            ; Производим вычитиние делителя из делимого
00CD   1C03           00359     btfss   STATUS, C               ;
00CE   03AA           00360     decf    work_data+1, f          ;
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00361 
00CF   1FAA           00362     btfss   work_data+1, 7          ; Проверка на отрицательный результат (бит 15=1)
00D0   2???           00363     goto    DW_Loop
                      00364 ;-----------------------------------------------------------------------
00D1   07A9           00365     addwf   work_data, f            ; Восстанавливаем остаток
00D2   0AAA           00366     incf    work_data+1, f          ;
                      00367 
00D3   0330           00368     decf    div_result, w           ; Возвращаем частное
                      00369 
00D4   0008           00370     return
                      00371 
                      00372 ;*******************************************************************************
                      00373 ;       GetSegments
                      00374 ;-------------------------------------------------------------------------------
                      00375 ; Возвращает комбинацию сегментов 7-сегментного индикатора для конкретной цифры
                      00376 ; На входе:
                      00377 ;       wreg - число от 0 до 9
                      00378 ; Навыходе:
                      00379 ;       wreg - комбинация сегментов
                      00380 ;-------------------------------------------------------------------------------
                      00381     ORG     0x0400
0400                  00382 GetSegments:
0400   018A           00383     clrf    PCLATH
0401   150A           00384     bsf     PCLATH, 2
0402   390F           00385     andlw   0xF
0403   0782           00386     addwf   PCL, f
                      00387 
0404   343F           00388     retlw   SEG_A + SEG_B + SEG_C + SEG_D + SEG_E + SEG_F           ; zero
0405   3406           00389     retlw   SEG_B + SEG_C                                           ; one
0406   345B           00390     retlw   SEG_A + SEG_B + SEG_D + SEG_E + SEG_G                   ; two
0407   344F           00391     retlw   SEG_A + SEG_B + SEG_C + SEG_D + SEG_G                   ; three
0408   3466           00392     retlw   SEG_B + SEG_C + SEG_F + SEG_G                           ; four
0409   346D           00393     retlw   SEG_A + SEG_C + SEG_D + SEG_F + SEG_G                   ; five
040A   347D           00394     retlw   SEG_A + SEG_C + SEG_D + SEG_E + SEG_F + SEG_G           ; six
040B   3407           00395     retlw   SEG_A + SEG_B + SEG_C                                   ; seven
040C   347F           00396     retlw   SEG_A + SEG_B + SEG_C + SEG_D + SEG_E + SEG_F + SEG_G   ; eight
040D   346F           00397     retlw   SEG_A + SEG_B + SEG_C + SEG_D + SEG_F + SEG_G           ; nine
                      00398 
                      00399     ; Дополняем таблицу до 16 значений, чтобы предотвратить
                      00400     ; улет неизвестно куда при неправильном значении wreg на входе
040E   3400           00401     retlw   0
040F   3400           00402     retlw   0
0410   3400           00403     retlw   0
0411   3400           00404     retlw   0
0412   3400           00405     retlw   0
0413   3400           00406     retlw   0
                      00407 
                      00408 #include "Init.inc"
                      00001 ;*******************************************************************************
                      00002 ;
                      00003 ;       ИНИЦИАЛИЗАЦИЯ    РЕГИСТРОВ   МИКРОКОНТРОЛЛЕРА  PIC16F628A
                      00004 ;
                      00005 ;*******************************************************************************
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00006     
0414                  00007 init:
                      00008     errorlevel -302 ;не напоминать что банк не 0
                      00009     ;--------------------------------------------------------------------------
                      00010     ;   BANK 0
                      00011     ;--------------------------------------------------------------------------
0414   1283           00012     bcf     STATUS, RP0
0415   1303           00013     bcf     STATUS, RP1     ;переход в банк 0 для доступа к регистрам банка 0
                      00014     ;INDF - обращение к регистру , адрес которого записан в FSR
                      00015     ;TMR0 - регистр таймера 0
                      00016     ;PCL - младшие биты счетчика команд
0416   0183           00017     clrf    STATUS          ;очистим STATUS
                      00018     ;FSR - регистр адреса при косвенной адресации
                      00019     ;настроим начальные уровни на выходах портов вывода
0417   0185           00020     clrf    PORTA 
0418   0186           00021     clrf    PORTB
0419   018A           00022     clrf    PCLATH          ;Подтвердим нулевое значеие в регистре защелке 
                      00023                             ;старших битов адреса команд
041A   3000           00024     movlw   b'00000000'     ;запрет прерываний всем
041B   008B           00025     movwf   INTCON
                      00026     ;PIR1
                      00027     ;TMR1L - младшие биты TMR1
                      00028     ;TMR1H - старшие биты TMR1
041C   3001           00029     movlw   b'00000001'
041D   0090           00030     movwf   T1CON
                      00031     ;TMR2 - регистр таймера 2
                      00032     ;T2CON
                      00033     ;CCPR1L - младший байт ШИМ CCP1
                      00034     ;CCPR1H - старший байт ШИМ CCP1
041E   3000           00035     movlw   b'00000000'     ;выключаем ШИМ CCP1
041F   0097           00036     movwf   CCP1CON
0420   0198           00037     clrf    RCSTA           ;USART OFF
                      00038     ;TXREG - регистр данных передатчика USART
                      00039     ;RСXREG - регистр данных приемника USART
0421   3007           00040     movlw   b'00000111'     ;выключаем компараторы
0422   009F           00041     movwf   CMCON
                      00042     
                      00043     ;--------------------------------------------------------------------------
                      00044     ;   BANK 1
                      00045     ;--------------------------------------------------------------------------
                      00046     
0423   1683           00047     bsf     STATUS, RP0
                      00048     ;INDF - обращение к регистру , адрес которого записан в FSR
0424   3087           00049     movlw   b'10000111'
0425   0081           00050     movwf   OPTION_REG ;Предделитель перед TMR0 коэффициент 1:256
                      00051     ;PCL - младшие биты счетчика команд
                      00052     ;STATUS 
                      00053     ;FSR - регистр адреса при косвенной адресации
0426   30F0           00054     movlw   b'11110000'     ; 5,4,6,7 - входы
0427   0085           00055     movwf   TRISA
0428   309C           00056     movlw   b'10011100'     ; 2,3,4,7 - входы
0429   0086           00057     movwf   TRISB
                      00058     ;PCLATH
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00059     ;INTCON
042A   018C           00060     clrf   PIE1 & 0x7F      ;запретили все периферийные прерывания
                      00061     ;PCON
                      00062     ;PR2 - регистр периода TMR2
                      00063     ;TXSTA - Регистр управления и статуса USART
                      00064     ;SPBRG - регистр генератора скорости USART
                      00065     ;EEDATA - регистр данных, младший байт
                      00066     ;EEADDR - регистр адреса, младший байт
                      00067     ;EECON1 - регистр управления 1
                      00068     ;EECON2 - регистр управления 2
                      00069     ;VRCON - регистр источника опорного напряжения
                      00070     
                      00071     ;--------------------------------------------------------------------------
                      00072     ;   BANK 2
                      00073     ;--------------------------------------------------------------------------
                      00074     ;bcf STATUS, RP0
                      00075     ;bsf STATUS, RP1
                      00076     ;INDF - обращение к регистру , адрес которого записан в FSR
                      00077     ;TMR0 - регистр таймера TMR0
                      00078     ;PCL - младшие биты счетчика команд
                      00079     ;STATUS
                      00080     ;FSR - регистр адреса при косвенной адресации
                      00081     ;PORTB - запись в выходную защелку PORTB, чтение состояния выводов PORTB
                      00082     ;PCLATH - старшие биты счетчика команд
                      00083     ;INTCON
                      00084     
                      00085     ;--------------------------------------------------------------------------
                      00086     ;   BANK 3
                      00087     ;--------------------------------------------------------------------------
                      00088     ;bsf STATUS, RP0
                      00089     ;bsf STATUS, RP1
                      00090     ;INDF - обращение к регистру , адрес которого записан в FSR
                      00091     ;OPTION_REG
                      00092     ;PCL - младшие биты счетчика команд
                      00093     ;STATUS
                      00094     ;FSR - регистр адреса при косвенной адресации
                      00095     ;TRISB - направление выводов PORTB
                      00096     ;PCLATH - старшие биты счетчика команд
                      00097     ;INTCON
                      00098     
042B   1283           00099     bcf     STATUS, RP0
042C   1303           00100     bcf     STATUS, RP1     ;возврат в BANK 0 
                      00101 
                      00102     ;Здесь, по потребности, присвоим переменным начальные значения
042D   3000           00103     movlw   0x00
                      00104 ;    movwf GPtmp ; При инициализации обнуляем регистр, выводимый в порт PORTC
042E   00A1           00105     movwf   Flags           ; При инициализации все флаги обнуляем
                      00106 ;    movwf ZERO
                      00107     ;Очистка регистров хранения температуры и времени охлаждения
                      00108 ;    movwf Heat_low
                      00109 ;    movwf Heat_high
042F   00C4           00110     movwf   TMR0_user_max
                      00111     ;очистка и запись констант для TMR0
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0430   00C1           00112     movwf   TMR0_inc
0431   00C3           00113     movwf   TMR0_user_inc
0432   00C4           00114     movwf   TMR0_user_max
                      00115     ;movlw 0x4E             ;~78 переполнений TMR0 = 1 секунда при Fosc = 20 МГц 
0433   3008           00116     movlw   .8              ;~8 переполнений = 0.1с
0434   00C2           00117     movwf   TMR0_max
0435   3004           00118     movlw   0x04
0436   0081           00119     movwf   TMR0
0437   0008           00120     return
                      00121 
                      00122 #INCLUDE Memory.inc 
                      00001 ;*******************************************************************************
                      00002 ;
                      00003 ;       ПЕРЕМЕННЫЕ
                      00004 ;
                      00005 ;*******************************************************************************
                      00006                 
  00000021            00007 Flags   equ      0x21       ; Флаги для таймеров
                      00008 
                      00009     cblock      0x22        ; Блок переменных для функций задержек на 1с и 150мс
  00000022            00010             d1 
  00000023            00011             d2
  00000024            00012             d3
                      00013     endc
                      00014     cblock      0x25
  00000025            00015         output_text         :3  ; Текстовое представление
  00000028            00016         cur_digit               ; Текущая цифра для отображения
                      00017 
  00000029            00018         work_data               ; Рабочие данные
                      00019 
  0000002A            00020         product             :3  ; Переменные для подпрограммы умножения
  0000002D            00021         multiplier          :2
                      00022 
  0000002F            00023         divider                 ; Переменная для подпрограммы деления со сдвигом
                      00024 
  00000030            00025         div_result              ; Переменные для bin2dec преобразования
                      00026     endc
                      00027 
  00000037            00028 TEMP    equ     0x37
  00000038            00029 TEMP_C  equ     0x38
  00000039            00030 counter equ     0x39
                      00031     cblock      0x41
  00000041            00032         TMR0_inc            ; Счетчик переполнений TMR0
  00000042            00033         TMR0_max            ; Максимальное количество переполнений TMR0 для 1 секунды
  00000043            00034         TMR0_user_inc       ; Количество итераций на данный момент
  00000044            00035         TMR0_user_max       ; Время нагрева
  00000045            00036         TMR0_user_max_cool  ; Время охлаждения
                      00037     endc
                      00038     
  00000001            00039 SEG_A           equ     (1<<0)          ; Назначение сегментов в индикаторах
  00000002            00040 SEG_B           equ     (1<<1)          ;  
  00000004            00041 SEG_C           equ     (1<<2)          ;    A 
  00000008            00042 SEG_D           equ     (1<<3)          ;  F   B 
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000010            00043 SEG_E           equ     (1<<4)          ;    G 
  00000020            00044 SEG_F           equ     (1<<5)          ;  E   C 
  00000040            00045 SEG_G           equ     (1<<6)          ;    D   H 
  00000080            00046 SEG_H           equ     (1<<7)          ;   
                      00047 ;-------------------------------------------------------------------------------
                      00048            
                      00049     cblock      0x70 ;Регистры для сохранения контекста при обработке прерывания
  00000070            00050         W_TEMP_
  00000071            00051         STATUS_TEMP
  00000072            00052         PCLATH_TEMP
  00000073            00053         FSR_osn
  00000074            00054         FSR_prer
                      00055     endc
                      00123 ; Init End ---------------------------------------------------------------------
                      00409 #include "Interrupt.inc"
                      00001 ;*******************************************************************************
                      00002 ;
                      00003 ;       Подпрограмма обработки прерываний
                      00004 ;
                      00005 ;*******************************************************************************
                      00006 
0438                  00007 Interrupt:
0438   00F0           00008     movwf       W_TEMP_          ;запись содержимого аккумулятора W в 
                      00009                                  ;регистр W_TEMP
0439   0E03           00010     swapf       STATUS,W         ;обменять местами полубайты регистра STATUS и
                      00011                                  ;с записью в W
043A   0183           00012     clrf        STATUS           ;очистка регистра STATUS, выбрать 0-й банк
043B   00F1           00013     movwf       STATUS_TEMP      ;запись содержимого аккумулятора W в
                      00014                                  ;регистр W_TEMP
                      00015 
                      00016                                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      00017                                  ;в случае если размер кода превышает 2048 слов:
043C   080A           00018     movf        PCLATH,W         ;запись содержимого регистра PCLATH в
043D   00F2           00019     movwf       PCLATH_TEMP      ;регистр PCLATH_TEMP
043E   018A           00020     clrf        PCLATH           ;очистка регистра PCLATH
                      00021                                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      00022 
                      00023                                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      00024                                  ;при использовании косвенной адресации:
043F   0804           00025     movf        FSR,W            ;запись содержимого регистра FSR в
0440   00F3           00026     movwf       FSR_osn          ;регистр FSR_osn
0441   0874           00027     movf        FSR_prer,W       ;запись содержимого регистра FSR_prer в
0442   0084           00028     movwf       FSR              ;регистр FSR
                      00029                                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      00030                                  
                      00031     ;---------------------------------------------------------------------------
                      00032     
0443   180C           00033     btfsc   PIR1, TMR1IF         ;проверка на переполнение от TMR1
0444   2???           00034     goto    Display
0445   110B           00035     bcf     INTCON, T0IF        ;очистим бит T0IF чтобы избежать повторного входа в прерывание
0446   0AC1           00036     incf    TMR0_inc, 1         ;инкремент прерывания
0447   1103           00037     bcf     STATUS, Z
0448   0841           00038     movf    TMR0_inc, 0         ;загрузка содержимого TMR0_inc в W
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0449   0642           00039     xorwf   TMR0_max, 0         ;сравнение W и TMR0_max, результат смотрим в Z
044A   1D03           00040     btfss   STATUS, Z
044B   2???           00041     goto    _no                 ;не равны
044C   2???           00042     goto    _yes                ;равны - прошло 100 мс
                      00043     
                      00044     
                      00045    
044D                  00046 _yes:
044D   0AC3           00047     incf    TMR0_user_inc, 1    ; Инкремент и проверка на переполнение
044E   1103           00048     bcf     STATUS, Z           ; счетчика
044F   0843           00049     movf    TMR0_user_inc ,0    ; 
0450   0644           00050     xorwf   TMR0_user_max, 0    ;
0451   1903           00051     btfsc   STATUS, Z           ;
                      00052     
0452   1421           00053     bsf     Flags, 0            ; Время прошло, установим флаг
0453   01C1           00054     clrf    TMR0_inc
0454                  00055 _no:
0454   3004           00056     movlw   0x04                ; Настройка таймера 0 для дальнейшего отсчета
0455   0081           00057     movwf   TMR0                
0456   2???           00058     goto    rollback
                      00059 ;------------------------------------------------------------------------------    
0457                  00060 Display:
                      00061     
0457   1286           00062     bcf     DATA_LED_2          ; Сначала гасим все три разряда
0458   1105           00063     bcf     ENABLE_LED          ;
                      00064     
0459   3008           00065     movlw   .8                  ; Счетчик для записи в сдвиговый регистр 
045A   00B9           00066     movwf   counter             ;
                      00067     
045B                  00068 Display_count: 
                      00069     
045B   1706           00070     bsf     CLK_B_2             ;
045C   1306           00071     bcf     CLK_B_2             ;
                      00072     
045D   0BB9           00073     decfsz  counter, 1          ;
045E   2???           00074     goto    Display_count       ;
                      00075     
                      00076     
045F   0828           00077     movf    cur_digit, w        ; Включаем 3 разряд
0460   1CA8           00078     btfss   cur_digit, 1        ;
0461   2???           00079     goto    SEG_2               ;
0462   1686           00080     bsf     DATA_LED_2          ;
0463   1706           00081     bsf     CLK_B_2             ;  
0464   1306           00082     bcf     CLK_B_2             ;
0465   1286           00083     bcf     DATA_LED_2          ;
0466   1706           00084     bsf     CLK_B_2             ;
0467   1306           00085     bcf     CLK_B_2             ;
0468   1706           00086     bsf     CLK_B_2             ;
0469   1306           00087     bcf     CLK_B_2             ;
                      00088     
046A                  00089 SEG_2:
046A   1C28           00090     btfss   cur_digit, 0        ; Включаем 2 разряд
046B   2???           00091     goto    SEG_3               ;
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

046C   1686           00092     bsf     DATA_LED_2          ;
046D   1706           00093     bsf     CLK_B_2             ;
046E   1306           00094     bcf     CLK_B_2             ;
046F   1286           00095     bcf     DATA_LED_2          ;
0470   1706           00096     bsf     CLK_B_2             ;
0471   1306           00097     bcf     CLK_B_2             ;
                      00098     
0472                  00099 SEG_3:    
0472   1D03           00100     btfss   STATUS, Z           ; Включаем 1 разряд
0473   2???           00101     goto    SEGMENTS            ;
0474   1686           00102     bsf     DATA_LED_2          ;
0475   1706           00103     bsf     CLK_B_2             ;
0476   1306           00104     bcf     CLK_B_2             ;
                      00105     
0477                  00106 SEGMENTS:                       ; Зажигаем сегмент
                      00107     
0477   3008           00108     movlw   .8                  ; Заполним счетчик для сдвигового регистра
0478   00B9           00109     movwf   counter             ;
0479   0828           00110     movf    cur_digit, w        ;
047A   3E25           00111     addlw   output_text         ;
047B   0084           00112     movwf   FSR                 ; FSR = адрес регистра 
047C   0800           00113     movf    INDF, W             ;
047D   3AFF           00114     xorlw   0xFF                ; Маска инверсии (для индикатора с общим анодом)
047E   00B7           00115     movwf   TEMP                ;
047F   0837           00116     movf    TEMP, W             ;
                      00117     
0480                  00118 COUNT:                          ; Заполнение сдвигового регистра
0480   1585           00119     bsf     DATA_LED            ;       
0481   1FB7           00120     btfss   TEMP, 7             ;
0482   1185           00121     bcf     DATA_LED            ;
0483   1485           00122     bsf     CLK_B               ;
0484   1085           00123     bcf     CLK_B               ;
0485   0DB7           00124     rlf     TEMP, 1             ;
0486   0BB9           00125     decfsz  counter, 1          ;
0487   2???           00126     goto    COUNT               ;
                      00127     
0488   0AA8           00128     incf    cur_digit, f        ; Переход к следующему сегменту
0489   0828           00129     movf    cur_digit, w        ;
048A   3A03           00130     xorlw   0x3                 ;
048B   1903           00131     btfsc   STATUS, Z           ;
048C   01A8           00132     clrf    cur_digit           ;
                      00133     
048D   100C           00134     bcf     PIR1, TMR1IF        ; Очистка флага прерывания от TMR1          
                      00135 ;-------------------------------------------------------------------------------    
048E                  00136 rollback:                       ; Восстановление контекста
                      00137     
048E   1505           00138     bsf     ENABLE_LED          ; Включаем выходы сдвиговых регистров
                      00139     
                      00140                                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      00141                                  ;при условии использования косвенной адресации:
048F   0804           00142     movf        FSR,W            ;запись содержимого регистра FSR в
0490   00F4           00143     movwf       FSR_prer         ;регистр FSR_prer
0491   0873           00144     movf        FSR_osn,W        ;запись содержимого регистра FSR_osn в
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0492   0084           00145     movwf       FSR              ;регистр FSR
                      00146                                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      00147 
                      00148                                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      00149                                  ;при условии сохранения регистра PCLATH:
0493   0872           00150     movf        PCLATH_TEMP,W    ;восстановление содержимого регистра PCLATH
0494   008A           00151     movwf       PCLATH           ;
                      00152                                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      00153 
0495   0E71           00154     swapf       STATUS_TEMP,W    ;восстановление содержимого регистра STATUS
0496   0083           00155     movwf       STATUS
                      00156 
0497   0EF0           00157     swapf       W_TEMP_,F         ;восстановление содержимого аккумулятора W
0498   0E70           00158     swapf       W_TEMP_,W
                      00159     
0499   0009           00160     retfie
                      00161     #include "Memory.inc"
                      00056 ;*******************************************************************************
                      00057 ;
                      00058 ;       ПЕРЕМЕННЫЕ
                      00059 ;
                      00060 ;*******************************************************************************
                      00061                 
  00000021            00062 Flags   equ      0x21       ; Флаги для таймеров
                      00063 
                      00064     cblock      0x22        ; Блок переменных для функций задержек на 1с и 150мс
  00000022            00065             d1 
  00000023            00066             d2
  00000024            00067             d3
                      00068     endc
                      00069     cblock      0x25
  00000025            00070         output_text         :3  ; Текстовое представление
  00000028            00071         cur_digit               ; Текущая цифра для отображения
                      00072 
  00000029            00073         work_data               ; Рабочие данные
                      00074 
  0000002A            00075         product             :3  ; Переменные для подпрограммы умножения
  0000002D            00076         multiplier          :2
                      00077 
  0000002F            00078         divider                 ; Переменная для подпрограммы деления со сдвигом
                      00079 
  00000030            00080         div_result              ; Переменные для bin2dec преобразования
                      00081     endc
                      00082 
  00000037            00083 TEMP    equ     0x37
  00000038            00084 TEMP_C  equ     0x38
  00000039            00085 counter equ     0x39
                      00086     cblock      0x41
  00000041            00087         TMR0_inc            ; Счетчик переполнений TMR0
  00000042            00088         TMR0_max            ; Максимальное количество переполнений TMR0 для 1 секунды
  00000043            00089         TMR0_user_inc       ; Количество итераций на данный момент
  00000044            00090         TMR0_user_max       ; Время нагрева
  00000045            00091         TMR0_user_max_cool  ; Время охлаждения
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00092     endc
                      00093     
  00000001            00094 SEG_A           equ     (1<<0)          ; Назначение сегментов в индикаторах
  00000002            00095 SEG_B           equ     (1<<1)          ;  
  00000004            00096 SEG_C           equ     (1<<2)          ;    A 
  00000008            00097 SEG_D           equ     (1<<3)          ;  F   B 
  00000010            00098 SEG_E           equ     (1<<4)          ;    G 
  00000020            00099 SEG_F           equ     (1<<5)          ;  E   C 
  00000040            00100 SEG_G           equ     (1<<6)          ;    D   H 
  00000080            00101 SEG_H           equ     (1<<7)          ;   
                      00102 ;-------------------------------------------------------------------------------
                      00103            
                      00104     cblock      0x70 ;Регистры для сохранения контекста при обработке прерывания
  00000070            00105         W_TEMP_
  00000071            00106         STATUS_TEMP
  00000072            00107         PCLATH_TEMP
  00000073            00108         FSR_osn
  00000074            00109         FSR_prer
                      00110     endc
                      00162 
                      00163 
                      00410 #include "Memory.inc"
                      00111 ;*******************************************************************************
                      00112 ;
                      00113 ;       ПЕРЕМЕННЫЕ
                      00114 ;
                      00115 ;*******************************************************************************
                      00116                 
  00000021            00117 Flags   equ      0x21       ; Флаги для таймеров
                      00118 
                      00119     cblock      0x22        ; Блок переменных для функций задержек на 1с и 150мс
  00000022            00120             d1 
  00000023            00121             d2
  00000024            00122             d3
                      00123     endc
                      00124     cblock      0x25
  00000025            00125         output_text         :3  ; Текстовое представление
  00000028            00126         cur_digit               ; Текущая цифра для отображения
                      00127 
  00000029            00128         work_data               ; Рабочие данные
                      00129 
  0000002A            00130         product             :3  ; Переменные для подпрограммы умножения
  0000002D            00131         multiplier          :2
                      00132 
  0000002F            00133         divider                 ; Переменная для подпрограммы деления со сдвигом
                      00134 
  00000030            00135         div_result              ; Переменные для bin2dec преобразования
                      00136     endc
                      00137 
  00000037            00138 TEMP    equ     0x37
  00000038            00139 TEMP_C  equ     0x38
  00000039            00140 counter equ     0x39
                      00141     cblock      0x41
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000041            00142         TMR0_inc            ; Счетчик переполнений TMR0
  00000042            00143         TMR0_max            ; Максимальное количество переполнений TMR0 для 1 секунды
  00000043            00144         TMR0_user_inc       ; Количество итераций на данный момент
  00000044            00145         TMR0_user_max       ; Время нагрева
  00000045            00146         TMR0_user_max_cool  ; Время охлаждения
                      00147     endc
                      00148     
  00000001            00149 SEG_A           equ     (1<<0)          ; Назначение сегментов в индикаторах
  00000002            00150 SEG_B           equ     (1<<1)          ;  
  00000004            00151 SEG_C           equ     (1<<2)          ;    A 
  00000008            00152 SEG_D           equ     (1<<3)          ;  F   B 
  00000010            00153 SEG_E           equ     (1<<4)          ;    G 
  00000020            00154 SEG_F           equ     (1<<5)          ;  E   C 
  00000040            00155 SEG_G           equ     (1<<6)          ;    D   H 
  00000080            00156 SEG_H           equ     (1<<7)          ;   
                      00157 ;-------------------------------------------------------------------------------
                      00158            
                      00159     cblock      0x70 ;Регистры для сохранения контекста при обработке прерывания
  00000070            00160         W_TEMP_
  00000071            00161         STATUS_TEMP
  00000072            00162         PCLATH_TEMP
  00000073            00163         FSR_osn
  00000074            00164         FSR_prer
                      00165     endc
                      00411 #include "Delay.inc"
                      00001 ;*******************************************************************************
                      00002 ;
                      00003 ;       Подпрограмма задержки на 1с
                      00004 ;
                      00005 ;*******************************************************************************
                      00006 ; Delay = 1 seconds
                      00007 ; Clock frequency = 20 MHz
                      00008 
                      00009 ; Actual delay = 1 seconds = 5000000 cycles
                      00010 ; Error = 0 %
                      00011 
                      00012         
                      00013 
049A                  00014 Delay
                      00015                         ;4999993 cycles
049A   302C           00016         movlw   0x2C
049B   00A2           00017         movwf   d1
049C   30E7           00018         movlw   0xE7
049D   00A3           00019         movwf   d2
049E   300B           00020         movlw   0x0B
049F   00A4           00021         movwf   d3
04A0                  00022 Delay_0
04A0   0BA2           00023         decfsz  d1, f
04A1   2???           00024         goto    $+2
04A2   0BA3           00025         decfsz  d2, f
04A3   2???           00026         goto    $+2
04A4   0BA4           00027         decfsz  d3, f
04A5   2???           00028         goto    Delay_0
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00029 
                      00030                         ;3 cycles
04A6   2???           00031         goto    $+1
04A7   0000           00032         nop
                      00033 
                      00034                         ;4 cycles (including call)
04A8   0008           00035         return
                      00036 
                      00037 ; Generated by http://www.piclist.com/cgi-bin/delay.exe (December 7, 2005 version)
                      00038 ; Thu Sep 05 10:00:46 2019 GMT
                      00039 
                      00040 ; See also various delay routines at http://www.piclist.com/techref/microchip/delays.htm 
                      00041 
                      00042 
                      00412 #include "Delay150ms.inc"
                      00001 ;*******************************************************************************
                      00002 ;
                      00003 ;       Подпрограмма задержки на 150мс
                      00004 ;
                      00005 ;*******************************************************************************
                      00006 ; Delay = 0.15 seconds
                      00007 ; Clock frequency = 20 MHz
                      00008 
                      00009 ; Actual delay = 0.15 seconds = 750000 cycles
                      00010 ; Error = 0 %
                      00011 
                      00012 
04A9                  00013 Delay_150
                      00014                         ;749992 cycles
04A9   3085           00015         movlw   0x85
04AA   00A2           00016         movwf   d1
04AB   30A3           00017         movlw   0xA3
04AC   00A3           00018         movwf   d2
04AD   3002           00019         movlw   0x02
04AE   00A4           00020         movwf   d3
04AF                  00021 Delay_1
04AF   0BA2           00022         decfsz  d1, f
04B0   2???           00023         goto    $+2
04B1   0BA3           00024         decfsz  d2, f
04B2   2???           00025         goto    $+2
04B3   0BA4           00026         decfsz  d3, f
04B4   2???           00027         goto    Delay_0
                      00028 
                      00029                         ;4 cycles
04B5   2???           00030         goto    $+1
04B6   2???           00031         goto    $+1
                      00032 
                      00033                         ;4 cycles (including call)
04B7   0008           00034         return
                      00035 
                      00036 #include "Memory.inc"
                      00166 ;*******************************************************************************
                      00167 ;
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00168 ;       ПЕРЕМЕННЫЕ
                      00169 ;
                      00170 ;*******************************************************************************
                      00171                 
  00000021            00172 Flags   equ      0x21       ; Флаги для таймеров
                      00173 
                      00174     cblock      0x22        ; Блок переменных для функций задержек на 1с и 150мс
  00000022            00175             d1 
  00000023            00176             d2
  00000024            00177             d3
                      00178     endc
                      00179     cblock      0x25
  00000025            00180         output_text         :3  ; Текстовое представление
  00000028            00181         cur_digit               ; Текущая цифра для отображения
                      00182 
  00000029            00183         work_data               ; Рабочие данные
                      00184 
  0000002A            00185         product             :3  ; Переменные для подпрограммы умножения
  0000002D            00186         multiplier          :2
                      00187 
  0000002F            00188         divider                 ; Переменная для подпрограммы деления со сдвигом
                      00189 
  00000030            00190         div_result              ; Переменные для bin2dec преобразования
                      00191     endc
                      00192 
  00000037            00193 TEMP    equ     0x37
  00000038            00194 TEMP_C  equ     0x38
  00000039            00195 counter equ     0x39
                      00196     cblock      0x41
  00000041            00197         TMR0_inc            ; Счетчик переполнений TMR0
  00000042            00198         TMR0_max            ; Максимальное количество переполнений TMR0 для 1 секунды
  00000043            00199         TMR0_user_inc       ; Количество итераций на данный момент
  00000044            00200         TMR0_user_max       ; Время нагрева
  00000045            00201         TMR0_user_max_cool  ; Время охлаждения
                      00202     endc
                      00203     
  00000001            00204 SEG_A           equ     (1<<0)          ; Назначение сегментов в индикаторах
  00000002            00205 SEG_B           equ     (1<<1)          ;  
  00000004            00206 SEG_C           equ     (1<<2)          ;    A 
  00000008            00207 SEG_D           equ     (1<<3)          ;  F   B 
  00000010            00208 SEG_E           equ     (1<<4)          ;    G 
  00000020            00209 SEG_F           equ     (1<<5)          ;  E   C 
  00000040            00210 SEG_G           equ     (1<<6)          ;    D   H 
  00000080            00211 SEG_H           equ     (1<<7)          ;   
                      00212 ;-------------------------------------------------------------------------------
                      00213            
                      00214     cblock      0x70 ;Регистры для сохранения контекста при обработке прерывания
  00000070            00215         W_TEMP_
  00000071            00216         STATUS_TEMP
  00000072            00217         PCLATH_TEMP
  00000073            00218         FSR_osn
  00000074            00219         FSR_prer
                      00220     endc
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00037 
                      00038 
                      00039 
3F18                  00413     end
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 21


SYMBOL TABLE
  LABEL                             VALUE 

ADDEN                             00000003
ADEN                              00000003
BRGH                              00000002
Bin2Dec                           000000BD
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CIS                               00000003
CLK_B                             PORTA, 1
CLK_B_2                           PORTB, 6
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000001F
CMIE                              00000006
CMIF                              00000006
COOL_LED                          PORTA, 0
COUNT                             00000480
CREN                              00000004
CSRC                              00000007
Cool                              0000007B
Cool_done                         00000081
DATA_CP_OFF                       00003FFF
DATA_CP_ON                        00003EFF
DATA_LED                          PORTA, 3
DATA_LED_2                        PORTB, 5
DC                                00000001
DW_Loop                           000000CB
Delay                             0000049A
Delay_0                           000004A0
Delay_1                           000004AF
Delay_150                         000004A9
Display                           00000457
Display_count                     0000045B
DivWreg                           000000CA
EEADR                             0000009B
EECON1                            0000009C
EECON2                            0000009D
EEDATA                            0000009A
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 22


SYMBOL TABLE
  LABEL                             VALUE 

EEIE                              00000007
EEIF                              00000007
EEPROM_READ                       0000008B
EEPROM_WRITE                      0000009E
ENABLE_LED                        PORTA, 2
END_WR                            0000009F
END_WRC                           000000AD
ERROR_LED                         PORTB, 0
F                                 00000001
FERR                              00000002
FSR                               00000004
FSR_osn                           00000073
FSR_prer                          00000074
Flags                             00000021
GIE                               00000007
GetSegments                       00000400
HEAT_B                            PORTB, 3
HEAT_LED                          PORTB, 1
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
Interrupt                         00000438
MINUS_B                           PORTA, 6
NOT_BO                            00000000
NOT_BOD                           00000000
NOT_BOR                           00000000
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_T1SYNC                        00000002
NOT_TO                            00000004
OERR                              00000001
OPTION_REG                        00000081
OSCF                              00000003
PCL                               00000002
PCLATH                            0000000A
PCLATH_TEMP                       00000072
PCON                              0000008E
PEIE                              00000006
PIE1                              0000008C
PIR1                              0000000C
PLUS_B                            PORTA, 5
PORTA                             00000005
PORTB                             00000006
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
RA0                               00000000
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 23


SYMBOL TABLE
  LABEL                             VALUE 

RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RP0                               00000005
RP1                               00000006
RX9                               00000006
RX9D                              00000000
SAVE_B                            PORTB, 7
SEGMENTS                          00000477
SEG_2                             0000046A
SEG_3                             00000472
SEG_A                             00000001
SEG_B                             00000002
SEG_C                             00000004
SEG_D                             00000008
SEG_E                             00000010
SEG_F                             00000020
SEG_G                             00000040
SEG_H                             00000080
SETUP_B                           PORTB, 2
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
STATUS                            00000003
STATUS_TEMP                       00000071
STOP_B                            PORTA, 4
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 24


SYMBOL TABLE
  LABEL                             VALUE 

T1OSCEN                           00000003
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TEMP                              00000037
TEMP_C                            00000038
TEMP_IN                           PORTA, 7
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR0_inc                          00000041
TMR0_max                          00000042
TMR0_user_inc                     00000043
TMR0_user_max                     00000044
TMR0_user_max_cool                00000045
TMR1                              0000000E
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISA6                            00000006
TRISA7                            00000007
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRMT                              00000001
TX9                               00000006
TX9D                              00000000
TXEN                              00000005
TXIE                              00000004
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 25


SYMBOL TABLE
  LABEL                             VALUE 

TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             0000009F
VREN                              00000007
VROE                              00000006
VRR                               00000005
W                                 00000000
WATER                             PORTB, 4
WR                                00000001
WREN                              00000002
WRERR                             00000003
W_TEMP_                           00000070
Work_done                         0000006E
Z                                 00000002
_.org_1_006A                      0000006A
_.org_2_04A1                      000004A1
_.org_2_04A3                      000004A3
_.org_2_04A6                      000004A6
_.org_2_04B0                      000004B0
_.org_2_04B2                      000004B2
_.org_2_04B5                      000004B5
_.org_2_04B6                      000004B6
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_BOREN_OFF                        00003FBF
_BOREN_ON                         00003FFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_OFF                           00003FFF
_CP_ON                            00001FFF
_DEVID1                           00002006
_ER_OSC_CLKOUT                    00003FFF
_ER_OSC_NOCLKOUT                  00003FFE
_EXTCLK_OSC                       00003FEF
_FOSC_ECIO                        00003FEF
_FOSC_EXTRCCLK                    00003FFF
_FOSC_EXTRCIO                     00003FFE
_FOSC_HS                          00003FEE
_FOSC_INTOSCCLK                   00003FFD
_FOSC_INTOSCIO                    00003FFC
_FOSC_LP                          00003FEC
_FOSC_XT                          00003FED
_HS_OSC                           00003FEE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
MPASM 5.84                          MAIN.ASM   9-10-2019  19:09:45         PAGE 26


SYMBOL TABLE
  LABEL                             VALUE 

_INTOSC_OSC_CLKOUT                00003FFD
_INTOSC_OSC_NOCLKOUT              00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FEC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC_CLKOUT                    00003FFF
_RC_OSC_NOCLKOUT                  00003FFE
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FED
__16F628A                         00000001
_no                               00000454
_yes                              0000044D
accident                          00000065
change_mode                       0000003D
checks                            00000022
counter                           00000039
cur_digit                         00000028
d1                                00000022
d2                                00000023
d3                                00000024
decrement                         00000056
decrement_cool                    00000060
div_result                        00000030
divider                           0000002F
heat                              0000001B
increment                         00000045
increment_cool                    00000050
increment_heat                    0000004A
init                              00000414
multiplier                        0000002D
output_text                       00000025
postinit                          00000014
postinit_0                        00000013
product                           0000002A
rollback                          0000048E
setup                             0000002E
start                             00000005
work_data                         00000029

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,    24 suppressed

